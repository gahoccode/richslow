services:
  # Backend Service - FastAPI with uv
  - type: web
    name: richslow-api
    runtime: python
    region: singapore
    plan: free
    branch: feature/nextjs-deployment
    rootDir: .
    buildCommand: uv sync
    startCommand: uv run uvicorn app.main:app --host 0.0.0.0 --port $PORT
    healthCheckPath: /health
    buildFilter:
      paths:
        - app/**
        - pyproject.toml
        - uv.lock
        - render.yaml
      ignoredPaths:
        - frontend/**
        - static/**
        - tests/**
        - docs/**
        - "*.md"
        - "*.txt"
        - ".gitignore"
        - "CHANGELOG.md"
        - "README.md"
        - "CLAUDE.md"
    envVars:
      - key: PYTHON_VERSION
        value: 3.10.11
      - key: UV_SYSTEM_PYTHON
        value: "1"
      - key: FRONTEND_URL
        value: https://richslow-frontend-2be8.onrender.com
    autoDeploy: true

  # Frontend Service - Next.js with Bun
  - type: web
    name: richslow-frontend
    runtime: node
    region: singapore
    plan: free
    branch: feature/nextjs-deployment
    rootDir: frontend
    buildCommand: bun install && bun run build
    startCommand: bun start
    healthCheckPath: /
    buildFilter:
      paths:
        - frontend/**
        - bun.lock
        - render.yaml
      ignoredPaths:
        - frontend/node_modules/**
        - "*.md"
        - "*.txt"
        - ".gitignore"
    envVars:
      - key: BUN_VERSION
        value: 1.2.18
      - key: NODE_ENV
        value: production
      - key: NEXT_PUBLIC_API_URL
        value: https://richslow-api-2be8.onrender.com/
    autoDeploy: true

version: "1"
